<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>TELEFUKER</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
html,body{
  margin:0;padding:0;
  background:#000;color:#fff;
  height:100vh;overflow:hidden
}
h1{
  text-align:center;
  letter-spacing:4px;
  margin:40px 0 15px;
  font-size:24px;
  user-select:none
}
.top-controls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 12px;
  margin-bottom:10px
}
.left-controls{
  display:flex;
  gap:10px;
  align-items:center
}
.right-controls{
  background:#0a3c0a;
  border:2px solid #0f7c0f;
  border-radius:8px;
  padding:6px 10px;
  min-width:140px;
  text-align:center
}
.right-controls select{
  background:transparent;
  color:#fff;
  border:none;
  width:100%;
  font-size:16px;
  text-align:center;
  text-align-last:center;
  appearance:none
}
select,button{
  background:#000;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
  padding:8px 12px;
  font-size:16px;
  cursor:pointer
}
button:disabled{opacity:.4}
.btn-undo{border-color:#b36b00;color:#ffb84d}
.btn-final{border-color:#2f6b3f;color:#9be5b1}
.btn-reset{border-color:#444;color:#aaa;width:130px}
.players{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  padding:0 12px;
  height:calc(100vh - 190px)
}
.player{
  background:#111;
  border:1px solid #222;
  border-radius:8px;
  padding:12px;
  display:flex;
  flex-direction:column
}
.name{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  background:transparent;
  border:none;
  color:#fff;
  outline:none
}
.compras{
  margin-top:6px;
  background:#ffeb3b;
  color:#000;
  padding:4px 10px;
  border-radius:6px;
  font-size:14px
}
.score-zone{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center
}
.score{
  font-size:72px;
  font-weight:bold
}
.buy-controls{
  display:flex;
  gap:10px;
  justify-content:center
}
.bottom{
  display:flex;
  justify-content:center;
  padding:10px
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999
}
.modal-box{
  background:#111;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:320px;
  text-align:center
}
.modal-box input{
  width:100%;
  padding:12px;
  font-size:24px;
  background:#000;
  color:#fff;
  border:1px solid #333;
  margin:15px 0
}
.modal-actions{
  display:flex;
  gap:12px
}
.modal-actions button{flex:1}
</style>
</head>

<body>

<h1>TELEFUKER</h1>

<div class="top-controls">
  <div class="left-controls">
    <select id="count">
      <option value="">Jugadores</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
    <button class="btn-undo" id="undo" disabled>⟵</button>
    <button class="btn-final" id="finalizar">FINALIZAR</button>
  </div>
  <div class="right-controls">
    <select id="gameSelect">
      <option>1/3</option><option>1/4</option><option>1/5</option>
      <option>2/3</option><option>1/3 1/4</option>
      <option>2/4</option><option>1/4 1/5</option>
      <option>2/5</option><option>Escalera</option>
    </select>
  </div>
</div>

<div class="players" id="players"></div>

<div class="bottom">
  <button class="btn-reset" id="consolidadoBtn">CONSOLIDADO</button>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <div id="modalText"></div>
    <input id="modalInput" type="number" />
    <div class="modal-actions" id="modalActions"></div>
  </div>
</div>

<script>
(() => {
let state = JSON.parse(localStorage.getItem("telefuker")) || {
  count:0, players:[], history:[], wins:{}, currentGame:"1/3"
};

const playersDiv=document.getElementById("players");
const countSel=document.getElementById("count");
const undoBtn=document.getElementById("undo");
const modal=document.getElementById("modal");
const modalText=document.getElementById("modalText");
const modalInput=document.getElementById("modalInput");
const modalActions=document.getElementById("modalActions");
const finalizarBtn=document.getElementById("finalizar");
const consolidadoBtn=document.getElementById("consolidadoBtn");

const save=()=>localStorage.setItem("telefuker",JSON.stringify(state));

function snapshot(){
  if(state.history.length>=20)state.history.shift();
  state.history.push(JSON.stringify(state));
  undoBtn.disabled=false
}

function render(){
  playersDiv.innerHTML="";
  if(!state.count)return;
  state.players.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="player";
    d.innerHTML=`
      <input class="name" value="${p.name}">
      <div class="compras">Compras: ${p.buy}</div>
      <div class="score-zone"><div class="score">${p.score}</div></div>
      <div class="buy-controls">
        <button ${p.buy===0?"disabled":""} data-u="${i}">USAR</button>
        <button data-a="${i}">+1</button>
      </div>`;
    d.querySelector(".score-zone").onclick=()=>openModal(i);
    d.querySelector("[data-u]").onclick=()=>{snapshot();p.buy--;save();render()}
    d.querySelector("[data-a]").onclick=()=>{if(confirm("¿Agregar compra?")){snapshot();p.buy++;save();render()}}
    playersDiv.appendChild(d)
  })
}

function openModal(i){
  modalText.textContent=`Puntos para ${state.players[i].name}`;
  modalInput.value="";
  modal.style.display="flex";
  modalActions.innerHTML=`
    <button onclick="ap(1)">SUMAR</button>
    <button onclick="ap(-1)">RESTAR</button>`;
  window.ap=(s)=>{
    const v=parseInt(modalInput.value);
    if(!v)return;
    snapshot();
    state.players[i].score+=v*s;
    modal.style.display="none";
    save();render()
  }
}

countSel.onchange=()=>{
  const n=parseInt(countSel.value);
  snapshot();
  state.count=n;
  state.players=[];
  for(let i=0;i<n;i++){
    const name=`JUGADOR ${i+1}`;
    state.players.push({name,score:0,buy:10});
    state.wins[name]=state.wins[name]||0
  }
  save();render()
}

finalizarBtn.onclick=()=>{
  const min=Math.min(...state.players.map(p=>p.score));
  state.players.filter(p=>p.score===min)
    .forEach(p=>state.wins[p.name]++);
  save();
  mostrarConsolidado()
}

consolidadoBtn.onclick=mostrarConsolidado;

function mostrarConsolidado(){
  modalInput.style.display="none";
  modalText.innerHTML="<b>CONSOLIDADO</b><br><br>"+Object.entries(state.wins)
    .map(([n,v])=>`${n}: ${v}`).join("<br>");
  modalActions.innerHTML=`<button onclick="modal.style.display='none'">OK</button>`;
  modal.style.display="flex"
}

undoBtn.onclick=()=>{
  if(!state.history.length)return;
  state=JSON.parse(state.history.pop());
  save();render();
  undoBtn.disabled=!state.history.length
}

render();
})();
</script>

</body>
</html>