<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>TELEFUKER</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
html,body{margin:0;padding:0;background:#000;color:#fff;height:100vh;overflow:hidden}

h1{
  text-align:center;
  letter-spacing:4px;
  margin:40px 0 15px;
  user-select:none;
  font-size:24px;
}

.top-controls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 12px;
  gap:8px;
  margin-bottom:10px;
}

.top-controls select,
.top-controls button{
  background:#000;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
  padding:8px 10px;
  font-size:16px;
  cursor:pointer;
}

.btn-undo{border-color:#b36b00;color:#ffb84d;font-size:22px}
.btn-final{border-color:#3f6b8f;color:#9ecbff}

.game-box{
  background:#0a3c0a;
  border:2px solid #0f7c0f;
  border-radius:8px;
  padding:6px 8px;
  min-width:120px;
  text-align:center;
}
.game-box select{
  background:transparent;
  border:none;
  color:#fff;
  width:100%;
  text-align:center;
  font-size:16px;
}

.players{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  padding:0 12px;
  height:calc(100vh - 220px);
}

.player{
  border:1px solid #222;
  background:#111;
  border-radius:8px;
  padding:12px;
  display:flex;
  flex-direction:column;
}

.name{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  background:transparent;
  border:none;
  color:#fff;
  outline:none;
  text-transform:uppercase;
}

.compras{
  margin-top:6px;
  background:#ffeb3b;
  color:#000;
  font-size:14px;
  padding:4px 10px;
  border-radius:6px;
}

.divider{height:1px;background:#333;margin:10px 0}

.score-zone{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.score{
  font-size:72px;
  font-weight:bold;
}

.buy-controls{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:10px;
}

.btn-use-buy{border-color:#cc6600;color:#ffb84d}
.btn-add-buy{border-color:#00662e;color:#94d48e}

.bottom{
  display:flex;
  justify-content:center;
  padding:12px 0;
}

.btn-consolidado{
  border-color:#6b2f2f;
  color:#e5a0a0;
  font-size:16px;
  padding:8px 14px;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal-box{
  background:#111;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:320px;
  text-align:center;
}

.modal-box input{
  width:100%;
  padding:12px;
  font-size:24px;
  text-align:center;
  background:#000;
  color:#fff;
  border:1px solid #333;
  margin:15px 0;
}

.modal-actions{display:flex;gap:10px}
.modal-actions button{flex:1;padding:10px;font-weight:bold}
</style>
</head>

<body>

<h1>TELEFUKER</h1>

<div class="top-controls">
  <select id="count">
    <option value="">Jugadores</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
  </select>

  <button class="btn-undo" id="undo" disabled>&larr;</button>

  <div class="game-box">
    <select id="gameSelect">
      <option>1/3</option><option>1/4</option><option>1/5</option>
      <option>2/3</option><option>1/3 1/4</option><option>2/4</option>
      <option>1/4 1/5</option><option>2/5</option><option>Escalera</option>
    </select>
  </div>

  <button class="btn-final" id="finalBtn">FINALIZAR</button>
</div>

<div class="players" id="players"></div>

<div class="bottom">
  <button class="btn-consolidado" id="consolidadoBtn">CONSOLIDADO</button>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <div id="modalText"></div>
    <input id="modalInput" type="number" />
    <div class="modal-actions" id="modalActions"></div>
  </div>
</div>

<script>
(() => {
let state=JSON.parse(localStorage.getItem("telefuker"))||{
  count:0,players:[],history:[],currentGame:"1/3"
};

const el=id=>document.getElementById(id);
const playersDiv=el("players"),countSel=el("count"),undoBtn=el("undo"),
modal=el("modal"),modalText=el("modalText"),modalInput=el("modalInput"),
modalActions=el("modalActions"),gameSelect=el("gameSelect"),
finalBtn=el("finalBtn"),consolidadoBtn=el("consolidadoBtn");

const save=()=>localStorage.setItem("telefuker",JSON.stringify(state));
const snapshot=()=>{
  state.history.push(JSON.stringify({
    count:state.count,
    players:JSON.parse(JSON.stringify(state.players)),
    currentGame:state.currentGame
  }));
  undoBtn.disabled=false;
};

function render(){
  playersDiv.innerHTML="";
  if(!state.count)return;
  gameSelect.value=state.currentGame;

  state.players.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="player";
    d.innerHTML=`
      <input class="name" value="${p.name.replace(/ \\d+$/,'')}">
      <div class="compras">Compras: ${p.buy}</div>
      <div class="divider"></div>
      <div class="score-zone"><div class="score">${p.score}</div></div>
      <div class="buy-controls">
        <button class="btn-use-buy" ${p.buy===0?"disabled":""}>USAR COMPRA</button>
        <button class="btn-add-buy">+1</button>
      </div>
    `;
    d.querySelector(".score-zone").onclick=()=>openScore(i);
    d.querySelector(".btn-use-buy").onclick=()=>{snapshot();p.buy--;save();render()};
    d.querySelector(".btn-add-buy").onclick=()=>{if(confirm("Â¿Agregar compra?")){snapshot();p.buy++;save();render()}};
    playersDiv.appendChild(d);
  });
}

function openScore(i){
  modal.style.display="flex";
  modalText.textContent=`Puntos para ${state.players[i].name}`;
  modalInput.value="";
  modalActions.innerHTML=`
    <button onclick="apply(${i},1)">SUMAR</button>
    <button onclick="apply(${i},-1)">RESTAR</button>
  `;
  modalInput.focus();
}

window.apply=(i,m)=>{
  const v=parseInt(modalInput.value);
  if(isNaN(v))return;
  snapshot();
  state.players[i].score+=v*m;
  modal.style.display="none";
  save();render();
};

finalBtn.onclick=()=>showConsolidado(true);
consolidadoBtn.onclick=()=>showConsolidado(false);

function showConsolidado(addWin){
  if(addWin){
    const min=Math.min(...state.players.map(p=>p.score));
    state.players.forEach(p=>{if(p.score===min)p.wins++});
    save();
  }
  modal.style.display="flex";
  modalInput.style.display="none";
  modalText.innerHTML=state.players
    .map(p=>`${p.name}: <b>${p.wins}</b>`)
    .join("<br>");
  modalActions.innerHTML=`<button onclick="modal.style.display='none'">CERRAR</button>`;
}

countSel.onchange=()=>{
  const n=parseInt(countSel.value);
  state.count=n;
  state.players=[];
  for(let i=0;i<n;i++)state.players.push({name:`NOMBRE ${i+1}`,score:0,buy:10,wins:0});
  save();render();
};

gameSelect.onchange=()=>{state.currentGame=gameSelect.value;save()};
undoBtn.onclick=()=>{
  if(!state.history.length)return;
  const s=JSON.parse(state.history.pop());
  state.count=s.count;state.players=s.players;state.currentGame=s.currentGame;
  save();render();
};

render();
})();
</script>

</body>
</html>